# Техническое задание

## Описание проекта
Необходимо разработать веб-сайт, базу данных и Telegram-бота для управления информацией о клиентах компании и их абонементах. Основной задачей проекта является создание удобного интерфейса, где клиенты могут просматривать свои активные абонементы, а администратор — управлять данными о клиентах через Telegram-бот.

---

## Основные компоненты системы

1. **База данных (БД)**
2. **Telegram-бот** для администратора и клиентов
3. **Веб-сайт** для клиентов с отображением данных из БД

---

## 1. Функциональные требования

### 1.1 База данных (БД)

- **Структура таблиц:**
  - **Таблица клиентов:**
    - `id` — Уникальный идентификатор клиента
    - `name` — Имя клиента
    - `tg_id` — Telegram ID клиента (заполняется при первой авторизации через уникальную ссылку)
    - `group_id` — ID группы, к которой прикреплен клиент
    - `membership_end_date` — Дата окончания абонемента
  - **Таблица групп:**
    - `id` — Уникальный идентификатор группы
    - `name` — Название группы (например, "Пн-Пт")
    - `days_of_week` — Дни занятий (например, `[‘Пн’, ‘Пт’]`)
    - `subscription_type` — Тип абонемента: 8 занятий, 4 занятия, «все включено»

- **Функционал вычисления даты окончания абонемента:**
  - Дата окончания абонемента автоматически рассчитывается при добавлении нового клиента на основе типа абонемента и расписания группы.

### 1.2 Telegram-бот

#### Основные функции:

- **Роли и доступы:**
  - Бот распознает администратора по `tg_id`, что дает ему доступ к расширенным функциям управления клиентами. Для клиентов бот предоставляет доступ к информации о текущем абонементе.

- **Функции для администратора:**
  - **Добавление нового клиента:** Администратор может создать запись клиента, указав его имя, группу и тип абонемента. Бот автоматически создает уникальную ссылку для клиента.
  - **Редактирование информации о клиенте:** Возможность изменить группу, тип абонемента, продлить или завершить абонемент.
  - **Удаление клиента:** Удаление записи о клиенте из БД.
  - **Управление через кнопки и текстовые команды:** Удобный интерфейс с кнопками и текстовыми командами, чтобы администратор мог управлять данными, не вводя SQL-запросы вручную.

- **Функции для клиента:**
  - **Регистрация через уникальную ссылку:** Бот генерирует уникальную ссылку для нового клиента. При переходе по ссылке бот фиксирует `tg_id` клиента и связывает его с его данными в базе.
  - **Просмотр абонемента:** После привязки клиента к базе, бот позволяет клиенту по запросу просматривать информацию о своем абонементе через Telegram Mini Apps.

### 1.3 Веб-сайт (интерфейс для клиентов)

- **Аутентификация по Telegram ID:** Вход клиента на сайт через Telegram Mini Apps, где данные идентифицируются с помощью его `tg_id`.
- **Просмотр информации о действующем абонементе:** Клиент видит данные об оставшихся занятиях или дате окончания абонемента, в зависимости от типа абонемента.
- **Поддержка нескольких типов абонементов:** Сайт отображает остаток занятий или даты завершения, учитывая специфические особенности каждого типа абонемента.

---

## 2. Сценарии использования

1. **Добавление нового клиента администратором:**
   - Администратор вводит команду `/add_client` в боте.
   - Бот запрашивает имя клиента, группу, тип абонемента.
   - После ввода данных бот генерирует уникальную ссылку и отправляет администратору для передачи клиенту.
   - Клиент переходит по ссылке, и бот автоматически привязывает его `tg_id` к записи в базе данных.

2. **Изменение данных о клиенте администратором:**
   - Администратор вводит команду `/update_client` и ID клиента.
   - Бот предоставляет меню для изменения группы, продления или завершения абонемента.
   - После подтверждения изменений бот обновляет данные в базе.

3. **Клиент запрашивает информацию о своем абонементе:**
   - Клиент отправляет команду `/abonement` боту или заходит на сайт через Telegram Mini Apps.
   - Сайт или бот получает `tg_id` клиента и выводит актуальную информацию об абонементе: дата окончания и оставшиеся занятия (если применимо).

---

## 3. Реализация и технические рекомендации

1. **Уникальные ссылки для привязки `tg_id`:**
   - Система генерирует уникальные ссылки вида `https://t.me/<bot_username>?start=<unique_code>`.
   - При переходе по ссылке бот получает `tg_id` клиента и `unique_code`, по которому идентифицирует запись клиента и закрепляет `tg_id`.

2. **API для связи между БД, сайтом и ботом:**
   - **API для Telegram-бота** — для добавления, обновления и удаления данных о клиентах, а также для запроса информации о клиенте.
   - **API для сайта** — для запроса информации о клиенте по его `tg_id`, полученному через Telegram Mini Apps.

3. **Контроль доступа и безопасность:**
   - Администраторский функционал бота доступен только по `tg_id`, заранее добавленному в список администраторов.
   - Уникальные ссылки действительны для однократного использования и автоматически закрепляют `tg_id` только для первой активации.
   - Для обеспечения безопасности данных при взаимодействии с ботом и сайтом нужно использовать HTTPS.

---
